---
- hosts: m910q
  tasks:
    - import_tasks: '../../tasks/infra/prometheus/server/main.yml'
    - import_tasks: '../../tasks/infra/prometheus/node/main.yml'
    - import_tasks: '../../tasks/infra/grafana/main.yml'

  handlers:
    - name: Restart Prometheus
      service:
        name: prometheus
        state: restarted
      when: 'not("/.dockerenv"|exists)'

    - name: Restart Prometheus Node Exporter
      service:
        name: prometheus-node-exporter
        state: restarted
      when: 'not("/.dockerenv"|exists)'

    - name: Restart Grafana
      service:
        name: grafana-server
        state: restarted
      when: 'not("/.dockerenv"|exists)'
